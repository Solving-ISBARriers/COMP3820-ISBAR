{"ast":null,"code":"var _jsxFileName = \"/Users/myoungseokjeong/Desktop/Masters/COMP3820_digital_health_software_project/Code/COMP3820-ISBAR/isbar-simple-react/src/IsbarSimpleInputField.js\";\nimport React from \"react\";\nimport TextInputField from \"./TextInputField\";\nimport TextAreaField from \"./TextAreaField\";\nimport { IsbarClientContext } from \"./IsbarFhirClient\";\nimport { isbarQuestionnaire } from \"./QuestionnaireTemplates\";\nimport { IsbarDoc } from \"./IsbarDoc\";\nimport { PDFDownloadLink } from \"@react-pdf/renderer\"; // Class for the input field group.\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class IsbarSimpleInputField extends React.Component {\n  // the this.context.client is the client object!!!\n  constructor(props) {\n    super(props);\n    this.state = {\n      // used true if data is loaded\n      loaded: false,\n      error: null,\n      // true if questionnaireResponse exists\n      responseExist: false,\n      patient: null,\n      questionnaire: null,\n      questionnaireResponse: null,\n      // turns true if it's isobar\n      isIsobar: false // would be good if we have a array of question-answer pair.\n\n    };\n  }\n\n  componentDidMount() {\n    // load client from the client context\n    const client = this.context.client; // Promise to set the patient... for?\n    //const loadPatient = client.patient.read().then(patient => this.setState({patient: patient}))\n    // Promise to load/create questionnaire\n\n    const loadQuestionnaire = client.request(\"Questionnaire?name=\" + isbarQuestionnaire.name).then(response => {\n      // Check if questionnaire exist or not\n      console.log(\"Questionnaires:\");\n      console.log(response);\n\n      if (response.total === 0) {\n        // there are no questionnaire object - create one\n        return client.create(isbarQuestionnaire);\n      } else {\n        // return the existing questionnaire to be saved\n        return response.entry[0].resource;\n      }\n    }).then(result => {\n      // save questionnaire, request questionnaireResponse\n      this.setState({\n        questionnaire: result\n      });\n      return client.request(\"QuestionnaireResponse?source=Patient/\" + this.context.client.patient.id);\n    }).then(response => {\n      // Check if there's an existing questionnaireResponse\n      console.log(\"Questionnaire Responses:\");\n      console.log(response);\n      var qResponse;\n\n      if (response.total > 0) {\n        if (response.entry.some(element => {\n          qResponse = element.resource;\n          return this.checkExistingResponse(element.resource);\n        })) {\n          // response that fulfills the criteria exists\n          console.log(\"Selected Response\"); //console.log(qResponse)\n\n          console.log(this.newQuestionnaireResponse()); //return client.create(this.newQuestionnaireResponse());\n\n          return qResponse;\n        }\n      } // no isbar responses - create one\n\n\n      console.log(\"No ISBAR questionnaire response from this patient. Creating one..\");\n      return client.create(this.newQuestionnaireResponse());\n    }).then(result => {\n      console.log(\"Questionnaire response result\");\n      console.log(result); // save the response object, finish loading\n\n      this.setState({\n        questionnaireResponse: result,\n        loaded: true,\n        error: null\n      });\n    }).catch(error => {\n      console.error(error);\n      this.setState({\n        error,\n        loaded: false\n      });\n    });\n  } // function to change the form to isobar form.\n\n\n  changeToIsobar() {} // check if the given resource is QuestionnaireResponse for isbar\n  // still need some check to see if it is actually for isbar\n\n\n  checkExistingResponse(resource) {\n    if (resource.source.reference === \"Patient/\" + this.context.client.patient.id && resource.questionnaire === \"Questionnaire/\" + this.state.questionnaire.id) {\n      return true;\n    }\n\n    return false;\n  } // function to send update request\n\n\n  updateResponse() {\n    console.log(\"Updated response: \" + JSON.stringify(this.state.questionnaireResponse));\n    this.context.client.update(this.state.questionnaireResponse).then(console.log).catch(console.error);\n  } // create new empty questionnaire response resource with this patient.\n  // returns the questionnaire object made.\n\n\n  newQuestionnaireResponse() {\n    // questionnaire response resource\n    var qResponse = {\n      resourceType: \"QuestionnaireResponse\",\n      text: {\n        name: \"isbar-simple-response\"\n      },\n      // maybe later when we sort out the thingy\n      // Reference the questionnaire\n      questionnaire: \"Questionnaire/\" + this.state.questionnaire.id,\n      status: \"in-progress\",\n      source: {\n        // refer to current patient\n        reference: \"Patient/\" + this.context.client.patient.id\n      },\n      item: [{\n        linkId: \"1\",\n        text: \"I:Identify\",\n        answer: [{\n          valueString: \"\"\n        }]\n      }, {\n        linkId: \"2\",\n        text: \"S:Situation\",\n        answer: [{\n          valueString: \"\"\n        }]\n      }, {\n        linkId: \"3\",\n        text: \"O:Observation\",\n        answer: [{\n          valueString: \"\"\n        }]\n      }, {\n        linkId: \"4\",\n        text: \"B:Background\",\n        answer: [{\n          valueString: \"\"\n        }]\n      }, {\n        linkId: \"5\",\n        text: \"A:Assessment\",\n        answer: [{\n          valueString: \"\"\n        }]\n      }, {\n        linkId: \"6\",\n        text: \"R:Recommendation\",\n        answer: [{\n          valueString: \"\"\n        }]\n      }]\n    };\n    return qResponse;\n  } // this is the function for changing value\n  // changes answer string in the questionnaireresponse object with given index\n  // updates questionnaireresponse state\n\n\n  handleChange(event, index) {\n    var response = this.state.questionnaireResponse;\n\n    if (response.item[index].hasOwnProperty(\"answer\")) {\n      response.item[index].answer[0].valueString = event.target.value;\n    } else {\n      response.item[index].answer = [{\n        valueString: event.target.value\n      }];\n    }\n\n    this.setState({\n      questionnaireResponse: response\n    });\n  }\n\n  printPDF() {} // Load the text fields after the questionnaire and questionnaire responses are loaded.\n\n\n  render() {\n    // questionnaire response object\n    if (this.state.loaded) {\n      if (this.state.isIsobar) {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"isbar-input-fields\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 11\n        }, this);\n      } else {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"container\",\n          children: [/*#__PURE__*/_jsxDEV(TextInputField, {\n            index: \"0\",\n            formID: \"introduction\",\n            label: \"I\",\n            placeholder: \"Introduction\",\n            item: this.state.questionnaireResponse.item[0],\n            handleChange: this.handleChange.bind(this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 251,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextInputField, {\n            index: \"1\",\n            formID: \"situation\",\n            label: \"S\",\n            placeholder: \"Situation\",\n            item: this.state.questionnaireResponse.item[1],\n            handleChange: this.handleChange.bind(this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextInputField, {\n            index: \"3\",\n            formID: \"background\",\n            label: \"B\",\n            placeholder: \"Background\",\n            item: this.state.questionnaireResponse.item[3],\n            handleChange: this.handleChange.bind(this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextInputField, {\n            index: \"4\",\n            formID: \"assessment\",\n            label: \"A\",\n            placeholder: \"Assessment\",\n            item: this.state.questionnaireResponse.item[4],\n            handleChange: this.handleChange.bind(this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextAreaField, {\n            index: \"5\",\n            formID: \"recommendation\",\n            label: \"R\",\n            placeholder: \"Recommendation\",\n            item: this.state.questionnaireResponse.item[5],\n            handleChange: this.handleChange.bind(this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"isbar-save\",\n            onClick: () => this.updateResponse(),\n            children: \"Save\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"isbar-save\",\n            children: /*#__PURE__*/_jsxDEV(PDFDownloadLink, {\n              document: /*#__PURE__*/_jsxDEV(IsbarDoc, {\n                content: this.state.questionnaireResponse\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 301,\n                columnNumber: 19\n              }, this),\n              fileName: \"isbar.pdf\",\n              children: ({\n                blob,\n                url,\n                loading,\n                error\n              }) => loading ? \"Preparing\" : \"Print\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 299,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 11\n        }, this);\n      }\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"isbar-loading\",\n        children: \"Loading the ISBAR form..\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 14\n      }, this);\n    }\n  }\n\n}\nIsbarSimpleInputField.contextType = IsbarClientContext;","map":{"version":3,"sources":["/Users/myoungseokjeong/Desktop/Masters/COMP3820_digital_health_software_project/Code/COMP3820-ISBAR/isbar-simple-react/src/IsbarSimpleInputField.js"],"names":["React","TextInputField","TextAreaField","IsbarClientContext","isbarQuestionnaire","IsbarDoc","PDFDownloadLink","IsbarSimpleInputField","Component","constructor","props","state","loaded","error","responseExist","patient","questionnaire","questionnaireResponse","isIsobar","componentDidMount","client","context","loadQuestionnaire","request","name","then","response","console","log","total","create","entry","resource","result","setState","id","qResponse","some","element","checkExistingResponse","newQuestionnaireResponse","catch","changeToIsobar","source","reference","updateResponse","JSON","stringify","update","resourceType","text","status","item","linkId","answer","valueString","handleChange","event","index","hasOwnProperty","target","value","printPDF","render","bind","blob","url","loading","contextType"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport TextInputField from \"./TextInputField\";\nimport TextAreaField from \"./TextAreaField\";\nimport { IsbarClientContext } from \"./IsbarFhirClient\";\nimport { isbarQuestionnaire } from \"./QuestionnaireTemplates\";\nimport { IsbarDoc } from \"./IsbarDoc\";\nimport { PDFDownloadLink } from \"@react-pdf/renderer\";\n\n// Class for the input field group.\nexport class IsbarSimpleInputField extends React.Component {\n  // the this.context.client is the client object!!!\n  static contextType = IsbarClientContext;\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      // used true if data is loaded\n      loaded: false,\n      error: null,\n      // true if questionnaireResponse exists\n      responseExist: false,\n\n      patient: null,\n      questionnaire: null,\n      questionnaireResponse: null,\n      // turns true if it's isobar\n      isIsobar: false,\n      // would be good if we have a array of question-answer pair.\n    };\n  }\n\n  componentDidMount() {\n    // load client from the client context\n    const client = this.context.client;\n\n    // Promise to set the patient... for?\n    //const loadPatient = client.patient.read().then(patient => this.setState({patient: patient}))\n\n    // Promise to load/create questionnaire\n    const loadQuestionnaire = client\n      .request(\"Questionnaire?name=\" + isbarQuestionnaire.name)\n      .then((response) => {\n        // Check if questionnaire exist or not\n\n        console.log(\"Questionnaires:\");\n        console.log(response);\n        if (response.total === 0) {\n          // there are no questionnaire object - create one\n          return client.create(isbarQuestionnaire);\n        } else {\n          // return the existing questionnaire to be saved\n          return response.entry[0].resource;\n        }\n      })\n      .then((result) => {\n        // save questionnaire, request questionnaireResponse\n\n        this.setState({ questionnaire: result });\n        return client.request(\n          \"QuestionnaireResponse?source=Patient/\" +\n            this.context.client.patient.id\n        );\n      })\n      .then((response) => {\n        // Check if there's an existing questionnaireResponse\n\n        console.log(\"Questionnaire Responses:\");\n        console.log(response);\n        var qResponse;\n\n        if (response.total > 0) {\n          if (\n            response.entry.some((element) => {\n              qResponse = element.resource;\n              return this.checkExistingResponse(element.resource);\n            })\n          ) {\n            // response that fulfills the criteria exists\n            console.log(\"Selected Response\");\n            //console.log(qResponse)\n            console.log(this.newQuestionnaireResponse());\n            //return client.create(this.newQuestionnaireResponse());\n            return qResponse;\n          }\n        }\n        // no isbar responses - create one\n        console.log(\n          \"No ISBAR questionnaire response from this patient. Creating one..\"\n        );\n        return client.create(this.newQuestionnaireResponse());\n      })\n      .then((result) => {\n        console.log(\"Questionnaire response result\");\n        console.log(result);\n        // save the response object, finish loading\n        this.setState({\n          questionnaireResponse: result,\n          loaded: true,\n          error: null,\n        });\n      })\n      .catch((error) => {\n        console.error(error);\n        this.setState({ error, loaded: false });\n      });\n  }\n\n  // function to change the form to isobar form.\n  changeToIsobar() {}\n\n  // check if the given resource is QuestionnaireResponse for isbar\n  // still need some check to see if it is actually for isbar\n  checkExistingResponse(resource) {\n    if (\n      resource.source.reference ===\n        \"Patient/\" + this.context.client.patient.id &&\n      resource.questionnaire === \"Questionnaire/\" + this.state.questionnaire.id\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  // function to send update request\n  updateResponse() {\n    console.log(\n      \"Updated response: \" + JSON.stringify(this.state.questionnaireResponse)\n    );\n    this.context.client\n      .update(this.state.questionnaireResponse)\n      .then(console.log)\n      .catch(console.error);\n  }\n\n  // create new empty questionnaire response resource with this patient.\n  // returns the questionnaire object made.\n  newQuestionnaireResponse() {\n    // questionnaire response resource\n    var qResponse = {\n      resourceType: \"QuestionnaireResponse\",\n      text: { name: \"isbar-simple-response\" },\n      // maybe later when we sort out the thingy\n      // Reference the questionnaire\n      questionnaire: \"Questionnaire/\" + this.state.questionnaire.id,\n      status: \"in-progress\",\n      source: {\n        // refer to current patient\n        reference: \"Patient/\" + this.context.client.patient.id,\n      },\n      item: [\n        {\n          linkId: \"1\",\n          text: \"I:Identify\",\n          answer: [\n            {\n              valueString: \"\",\n            },\n          ],\n        },\n        {\n          linkId: \"2\",\n          text: \"S:Situation\",\n          answer: [\n            {\n              valueString: \"\",\n            },\n          ],\n        },\n        {\n          linkId: \"3\",\n          text: \"O:Observation\",\n          answer: [\n            {\n              valueString: \"\",\n            },\n          ],\n        },\n        {\n          linkId: \"4\",\n          text: \"B:Background\",\n          answer: [\n            {\n              valueString: \"\",\n            },\n          ],\n        },\n        {\n          linkId: \"5\",\n          text: \"A:Assessment\",\n          answer: [\n            {\n              valueString: \"\",\n            },\n          ],\n        },\n        {\n          linkId: \"6\",\n          text: \"R:Recommendation\",\n          answer: [\n            {\n              valueString: \"\",\n            },\n          ],\n        },\n      ],\n    };\n\n    return qResponse;\n  }\n\n  // this is the function for changing value\n  // changes answer string in the questionnaireresponse object with given index\n  // updates questionnaireresponse state\n  handleChange(event, index) {\n    var response = this.state.questionnaireResponse;\n\n    if (response.item[index].hasOwnProperty(\"answer\")) {\n      response.item[index].answer[0].valueString = event.target.value;\n    } else {\n      response.item[index].answer = [\n        {\n          valueString: event.target.value,\n        },\n      ];\n    }\n\n    this.setState({ questionnaireResponse: response });\n  }\n\n  printPDF() {}\n\n  // Load the text fields after the questionnaire and questionnaire responses are loaded.\n  render() {\n    // questionnaire response object\n\n    if (this.state.loaded) {\n      if (this.state.isIsobar) {\n        return (\n          <div className=\"isbar-input-fields\">\n            {/* <TextInputField label=\"I\" heading=\"Heading\" value={this.state.questionnaireResponse} />\n                        <TextInputField label=\"S\" heading=\"Heading\" value=\"Loading....\" />\n                        <TextInputField label=\"O\" heading=\"Heading\" value=\"Loading...\" />\n                        <TextInputField label=\"B\" heading=\"Heading\" value=\"Loading...\" />\n                        <TextInputField label=\"A\" heading=\"Heading\" value=\"Loading...\" />\n                        <TextInputField label=\"R\" heading=\"Heading\" value=\"Loading...\" /> */}\n          </div>\n        );\n      } else {\n        return (\n          <div className=\"container\">\n            <TextInputField\n              index=\"0\"\n              formID=\"introduction\"\n              label=\"I\"\n              placeholder=\"Introduction\"\n              item={this.state.questionnaireResponse.item[0]}\n              handleChange={this.handleChange.bind(this)}\n            />\n            <TextInputField\n              index=\"1\"\n              formID=\"situation\"\n              label=\"S\"\n              placeholder=\"Situation\"\n              item={this.state.questionnaireResponse.item[1]}\n              handleChange={this.handleChange.bind(this)}\n            />\n            <TextInputField\n              index=\"3\"\n              formID=\"background\"\n              label=\"B\"\n              placeholder=\"Background\"\n              item={this.state.questionnaireResponse.item[3]}\n              handleChange={this.handleChange.bind(this)}\n            />\n            <TextInputField\n              index=\"4\"\n              formID=\"assessment\"\n              label=\"A\"\n              placeholder=\"Assessment\"\n              item={this.state.questionnaireResponse.item[4]}\n              handleChange={this.handleChange.bind(this)}\n            />\n            <TextAreaField\n              index=\"5\"\n              formID=\"recommendation\"\n              label=\"R\"\n              placeholder=\"Recommendation\"\n              item={this.state.questionnaireResponse.item[5]}\n              handleChange={this.handleChange.bind(this)}\n            />\n            <button\n              className=\"isbar-save\"\n              onClick={() => this.updateResponse()}\n            >\n              Save\n            </button>\n\n            <button className=\"isbar-save\">\n              <PDFDownloadLink\n                document={\n                  <IsbarDoc content={this.state.questionnaireResponse} />\n                }\n                fileName=\"isbar.pdf\"\n              >\n                {({ blob, url, loading, error }) =>\n                  loading ? \"Preparing\" : \"Print\"\n                }\n              </PDFDownloadLink>\n            </button>\n          </div>\n        );\n      }\n    } else {\n      return <div className=\"isbar-loading\">Loading the ISBAR form..</div>;\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}